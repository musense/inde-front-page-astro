---
import Layout from '@layouts/Layout.astro';
import ContentPage from '@views/index-sections/ContentPage';
import {
  getTitleContentsByID,
  getTitleContentsByCategoryAndGetOnlyID,
  getRelatedArticles,
  getTitleContents,
} from '@assets/js/titleContents';

const env: ImportMetaEnv = import.meta.env;
// console.log('ðŸš€ ~ file: index.astro:8 ~ env:', env);
// console.log('ðŸš€ ~ file: index.astro:8 ~ env.VITE_TITLE:', env.VITE_TITLE);

// export const prerender = true;

const { category, id } = Astro.params;
// console.log('ðŸš€ ~ file: [id].astro:10 ~ category:', category);
// console.log('ðŸš€ ~ file: [id].astro:10 ~ id:', id);

const payload = {
  _id: id,
  apiUrl: env.VITE_SERVER_URL,
};
const mainContent = await getTitleContentsByID(payload);
const relatedArticles = await getRelatedArticles(payload);
// console.log('ðŸš€ ~ file: index.astro:29 ~ relatedArticles:', relatedArticles);
const titleContents = await getTitleContents(payload);
// console.log('ðŸš€ ~ file: index.astro:31 ~ titleContents:', titleContents);
// console.log('ðŸš€ ~ file: [id].astro:16 ~ data:', data);

const title = mainContent.headTitle ? mainContent.headTitle : mainContent.title;
const description = mainContent.headDescription;
const keywords = mainContent.headKeyword;

export async function getStaticPaths() {
  const navItems = ['lottery', 'sports', 'poker', 'matka', 'casino'];
  const getStaticPaths = new Promise((resolve, reject) => {
    const staticPaths = navItems.map(async (category) => {
      const listPayload = {
        categoryName: category,
        page: 1,
        apiUrl: import.meta.env.VITE_SERVER_URL,
      };
      const idArray = await getTitleContentsByCategoryAndGetOnlyID(listPayload);
      // idArray.map((id) => {
      //   console.log(
      //     `ðŸš€ ~ file: index.astro:46 ~ returnidArray.map ~ ${category} id: `,
      //     id
      //   );
      // });
      return idArray.map((id) => [
        {
          params: {
            category: category,
            id: id,
          },
        },
      ]);
    });

    Promise.all(staticPaths).then((res) => {
      const paths = res.flat(2);
      console.log('ðŸš€ ~ file: index.astro:52 ~ Promise.all ~ paths:', paths);
      resolve(paths);
    });
  });
  const staticPaths = await getStaticPaths;
  // console.log("ðŸš€ ~ file: index.astro:60 ~ getStaticPaths ~ staticPaths:", staticPaths)
  return staticPaths;
}
---

<Layout
  title={title}
  description={description}
  keywords={keywords}
  path={'/'}
>
  <ContentPage
    client:load
    category={category}
    mainContent={mainContent}
    relatedArticles={relatedArticles}
    titleContents={titleContents}
  />
</Layout>
