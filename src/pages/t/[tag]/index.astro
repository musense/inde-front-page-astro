---
import Layout from '@layouts/Layout.astro';
import CommonPage from '@components/commonPage/commonPage';
import {
  getTagInfo,
  getTagList,
  getTagsContents,
} from '@assets/js/tagContents';

const env: ImportMetaEnv = import.meta.env;
console.log(
  'ðŸš€ ~ file: index.astro:8 ~ env.VITE_SERVER_URL:',
  env.VITE_SERVER_URL
);

const { tag } = Astro.params;
const apiUrl = env.VITE_SERVER_URL;
const payload = {
  tagName: tag,
  page: 1,
  apiUrl: import.meta.env.VITE_SERVER_URL,
};
const { data: tagItems } = await getTagsContents(payload);
const tagInfo = await getTagInfo(payload);
export async function getStaticPaths() {
  const payload = {
    apiUrl: import.meta.env.VITE_SERVER_URL,
    page: 1,
  };
  const tagList = await getTagList(payload);
  return tagList.map((tag) => [
    {
      params: {
        tag: tag.name,
      },
    },
  ]);
}

const title = tagInfo.headTitle ? tagInfo.headTitle : tagInfo.name;
const description = tagInfo.headDescription
const keywords = tagInfo.headKeyword
console.log('ðŸš€ ~ file: [tag].astro:16 ~ tag:', tag);
console.log('ðŸš€ ~ file: [tag].astro:16 ~ tagItems:', tagItems);
---

<Layout
  title={title}
  description={description}
  keywords={keywords}
  path={`/t/${tag}`}
>
  <CommonPage
    client:load
    paramName={`# ${tag}`}
    data={tagItems}
    apiUrl={apiUrl}
  />
</Layout>
